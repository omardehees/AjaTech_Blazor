@page "/FinancialOffer"
@layout MainLayout_Contracting

@using AjaTech_Blazor.Data.ViewModels;
@using System.Threading.Tasks;
@using Microsoft.Extensions.Configuration;
@using AjaTech_Blazor.Data.IServices;
@using System.Diagnostics;

@inject AKSoftware.Localization.MultiLanguages.ILanguageContainerService languageContainer
@inject HttpClient httpClient;
@inject NavigationManager UriHelper
@inject IJSRuntime jsRuntime
@inject IConfiguration Configuration
@inject Blazored.SessionStorage.ISessionStorageService sessionStorage
@inject IFileUpload fileupload

@*--------------------/ Container Page -----------Pre_Purchases_Offers_api----------------*@
<div class="container card-container">
    <div class="row">
        <div class="col-lg-12 text-center font-weight-bold" style="border:#e8e11f 1px solid;background-color:#868218;color:white;margin-top:20px;font-size:x-large;border-radius:5px">@languageContainer.Keys["Create_FinancialOffer"]</div>
        @*=================  الحقول الثابته ======================*@

        <div class="col-lg-12 control-section">
            <div class="row" style="direction:@languageContainer.Keys["Text_Direction"]">
                @*كود العرض المالي*@
                <div class="col-lg-3 font-weight-bold form-group" style="text-align:@languageContainer.Keys["Style_Text_Align"]">
                    <SfTextBox @bind-Value="txtHardCopyCode_FinancialOffer_Value" Placeholder='@languageContainer.Keys["FinancialOffer_Code"]'
                               Enabled="false" FloatLabelType="@FloatLabelType.Always" CssClass='form-control'></SfTextBox>
                </div>
                @*كود العرض الفني*@
                <div class="col-lg-3 font-weight-bold form-group" style="text-align:@languageContainer.Keys["Style_Text_Align"]">
                    <SfTextBox @bind-Value="txtHardCopyCode_TechnicalOffer_Value"
                               Placeholder='@languageContainer.Keys["TechnicalOffer_Code"]' Enabled="false"
                               FloatLabelType="@FloatLabelType.Always" CssClass='form-control'></SfTextBox>
                </div>
                @*قائمة العملاء*@
                <div class="col-lg-3 font-weight-bold form-group" style="text-align:@languageContainer.Keys["Style_Text_Align"]">
                    <SfDropDownList ShowClearButton="true" @bind-Value="cmbCustomer_Value" AllowFiltering="true" CssClass="pr-1 pl-1"
                                    DataSource="DataSource_AvailablerSupplier" TValue="string"
                                    TItem="string" Placeholder='@languageContainer.Keys["Customer_Name"]'
                                    FloatLabelType="@FloatLabelType.Always">
                        <DropDownListFieldSettings Text="Title" Value="Title"></DropDownListFieldSettings>
                    </SfDropDownList>
                </div>
                @*نهاية صلاحية العرض*@
                <div class="col-lg-3 font-weight-bold form-group" style="text-align:@languageContainer.Keys["Style_Text_Align"]">
                    <SfDatePicker @bind-Value="deValidTo" TValue="DateTime" Placeholder='@languageContainer.Keys["validTo"]' FloatLabelType="@FloatLabelType.Always" CssClass='form-control'></SfDatePicker>
                </div>
                @*تكلفة مكونات العرض الفني*@
                <div class="col-lg-2 font-weight-bold form-group"
                     style="text-align:@languageContainer.Keys["Style_Text_Align"]">
                    <SfTextBox @bind-Value="txtTechnical_Offer_Cost_Value"
                               Placeholder='@languageContainer.Keys["Component_Cost"]'
                               Enabled="false" FloatLabelType="@FloatLabelType.Always"
                               ValueChange="Update_Prices"
                               CssClass='form-control'>
                    </SfTextBox>
                </div>
                @*إجمالي التكلفة الإضافية*@
                <div class="col-lg-2 font-weight-bold form-group" style="text-align:@languageContainer.Keys["Style_Text_Align"]">
                    <SfTextBox @ref="txtFiniancial_Offer_Total_Extra_Costs"
                               Placeholder='@languageContainer.Keys["Extra_Cost"]'
                               Enabled="false" FloatLabelType="@FloatLabelType.Always"
                               ValueChange="Update_Prices"
                               CssClass='form-control'></SfTextBox>
                </div>
                @*قيمة الربح*@
                <div class="col-lg-2 font-weight-bold form-group" style="text-align:@languageContainer.Keys["Style_Text_Align"]">
                    <SfTextBox @bind-Value="txtFiniancial_Offer_Profit"
                               Placeholder='@languageContainer.Keys["Profit"]'
                               Enabled="false" FloatLabelType="@FloatLabelType.Always"
                               ValueChange="Update_Prices"
                               CssClass='form-control'></SfTextBox>
                </div>
                @*قيمة الضريبة*@
                <div class="col-lg-2 font-weight-bold form-group" style="text-align:@languageContainer.Keys["Style_Text_Align"]">
                    <SfTextBox @bind-Value="txtVat"
                               Placeholder='@languageContainer.Keys["FinancialOffer_VAT"]'
                               Enabled="false" FloatLabelType="@FloatLabelType.Always"
                               ValueChange="Update_Prices"
                               CssClass='form-control'></SfTextBox>
                </div>
                @*إجمالي التكلفة على العميل*@
                <div class="col-lg-2 font-weight-bold form-group" style="text-align:@languageContainer.Keys["Style_Text_Align"]">
                    <SfTextBox @bind-Value="txtFiniancial_Offer_Customer_Cost"
                               Placeholder='@languageContainer.Keys["Total_Contracting"]'
                               Enabled="false" FloatLabelType="@FloatLabelType.Always"
                               CssClass='form-control'></SfTextBox>
                </div>
                @* زر حفظ التعاقد   *@
                <div class="col-lg-2 font-weight-bold form-group" style="margin-top:auto">
                    <SfButton @ref="ref_btnSave_FiancialOffer" OnClick="btnSave_FiancialOffer" type="button" CssClass="e-btn e-normal e-success form-control font-weight-bold">@languageContainer.Keys["Save"]</SfButton>
                </div>

            </div>
        </div>

        @*================= / الحقول الثابته ======================*@

        @*========================================= All Tabs   ========================================================*@
        <SfTab EnablePersistence="true" CssClass="text-center" EnableRtl="true">
            <TabItems>

                @*========================================= Tab   العروض الفنية========================================================*@
                @*-----------------------------------------    ---------------------------------------------*@

                <TabItem>
                    <ChildContent>
                        <TabHeader Text="@languageContainer.Keys["TechnicalOffers"]"></TabHeader>
                    </ChildContent>
                    <ContentTemplate>
                        <div class="tab-content">
                            @*=========================================  Content Page   ========================================================*@
                            @*---------------------------------------------- شبكة العروض الفنية    ----------------------------------- -----------------*@
                            <div class="col-lg-12 control-section">
                                <div class="content-wrapper">
                                    <div class="row">
                                        <div class="col-lg-12 text-center font-weight-bold" style="border:gray 1px solid;background-color:#1b809e;margin-top:20px;font-size:x-large;border-radius:5px;color:white">@languageContainer.Keys["TechnicalOffers"]</div>
                                        <SfGrid @ref="grdTechnicalOffers" EnableRtl="true" DataSource="DataSource_TechnicalOffers" AllowSelection="true" AllowResizing="true" Width="100%" AllowPaging="true" Toolbar="@(new string[] { "Search" })">
                                            <GridEvents RowSelected="RowSelect_TechnicalOffers"
                                                        QueryCellInfo="CellColor_TechnicalOffers"
                                                        TValue="VM_Inv_Pre_Sales_Techical_Offer"></GridEvents>
                                            <GridSelectionSettings Mode="Syncfusion.Blazor.Grids.SelectionMode.Row"></GridSelectionSettings>
                                            <GridColumns>
                                                <GridColumn Field=@nameof(VM_Inv_Pre_Sales_Techical_Offer.HardCopyCode) HeaderText="@languageContainer.Keys["TechnicalOffer_Code"]" TextAlign="TextAlign.Center"></GridColumn>
                                                <GridColumn Field=@nameof(VM_Inv_Pre_Sales_Techical_Offer.ELevator_Title) HeaderText="@languageContainer.Keys["ELevator_Title"]" TextAlign="TextAlign.Center"></GridColumn>
                                                <GridColumn Field=@nameof(VM_Inv_Pre_Sales_Techical_Offer.Machine_Type) HeaderText="@languageContainer.Keys["Elevator_Type"]" TextAlign="TextAlign.Center"></GridColumn>
                                                <GridColumn Field=@nameof(VM_Inv_Pre_Sales_Techical_Offer.Path_Length) HeaderText="@languageContainer.Keys["ElvTrack"]" TextAlign="TextAlign.Center"></GridColumn>
                                                <GridColumn Field=@nameof(VM_Inv_Pre_Sales_Techical_Offer.Exterior_Entrance_Count) HeaderText="@languageContainer.Keys["OutGatesCount"]" TextAlign="TextAlign.Center"></GridColumn>
                                                <GridColumn Field=@nameof(VM_Inv_Pre_Sales_Techical_Offer.Wires_Count) HeaderText="@languageContainer.Keys["WiresCount"]" TextAlign="TextAlign.Center"></GridColumn>
                                                <GridColumn Field=@nameof(VM_Inv_Pre_Sales_Techical_Offer.Suspension_Type) HeaderText="@languageContainer.Keys["SuspensionType"]" TextAlign="TextAlign.Center"></GridColumn>
                                                <GridColumn Field=@nameof(VM_Inv_Pre_Sales_Techical_Offer.Box_Entrance_Count) HeaderText="@languageContainer.Keys["CabinGatesCount"]" TextAlign="TextAlign.Center"></GridColumn>
                                                <GridColumn Field=@nameof(VM_Inv_Pre_Sales_Techical_Offer.DoorType) HeaderText="@languageContainer.Keys["DoorType"]" TextAlign="TextAlign.Center"></GridColumn>
                                                <GridColumn Field=@nameof(VM_Inv_Pre_Sales_Techical_Offer.Door_Sensor) HeaderText="@languageContainer.Keys["SensorType"]" TextAlign="TextAlign.Center"></GridColumn>
                                                <GridColumn Field=@nameof(VM_Inv_Pre_Sales_Techical_Offer.Levels) HeaderText="@languageContainer.Keys["StoreyCount"]" TextAlign="TextAlign.Center"></GridColumn>
                                                <GridColumn Field=@nameof(VM_Inv_Pre_Sales_Techical_Offer.Persons) HeaderText="@languageContainer.Keys["Persons"]" TextAlign="TextAlign.Center"></GridColumn>
                                                <GridColumn Field=@nameof(VM_Inv_Pre_Sales_Techical_Offer.Notes) HeaderText="@languageContainer.Keys["Notes"]" TextAlign="TextAlign.Center"></GridColumn>
                                                <GridColumn Field=@nameof(VM_Inv_Pre_Sales_Techical_Offer.Issuied_By) HeaderText="@languageContainer.Keys["Issuance_By"]" TextAlign="TextAlign.Center" Width="110"></GridColumn>
                                                <GridColumn Field=@nameof(VM_Inv_Pre_Sales_Techical_Offer.Approved_By) HeaderText="@languageContainer.Keys["Approval"]" TextAlign="TextAlign.Center"></GridColumn>
                                                <GridColumn Field=@nameof(VM_Inv_Pre_Sales_Techical_Offer.Approved_At) EditType="EditType.DatePickerEdit" Format="d/M/yyyy" Type="ColumnType.Date" HeaderText="@languageContainer.Keys["Approval_Date"]" TextAlign="TextAlign.Center" Width="120"></GridColumn>
                                            </GridColumns>
                                        </SfGrid>
                                    </div>
                                </div>
                            </div>
                            @*-----------------------------------------------------------------------------------------------------*@
                            @*-------------------------------------------------- شبكة تفاصيل العروض الفنية --------------------------------- -----------------*@
                            <div class="col-lg-12 control-section">
                                <div class="content-wrapper">
                                    <div class="row">
                                        <div class="col-lg-12 text-center font-weight-bold" style="border:#808080 1px solid;background-color:#1b809e;margin-top:20px;font-size:x-large;border-radius:5px;color:white">@languageContainer.Keys["TechnicalOfferDetails"]</div>
                                        <SfGrid @ref="grdTechnicalOffer_Details" EnableRtl="true" AllowSelection="true" AllowResizing="true" DataSource="DataSource_TechnicalOffer_Details" Width="100%" AllowPaging="true" Toolbar="@(new string[] { "Search" })">
                                            <GridSelectionSettings PersistSelection="true"></GridSelectionSettings>
                                            <GridColumns>
                                                <GridColumn Field=@nameof(VM_Inv_Pre_Sales_Techical_Offer_Details.ID) Visible="false" IsPrimaryKey="true" IsIdentity="true" DefaultValue="1" HeaderText="@languageContainer.Keys["ID"]" TextAlign="TextAlign.Center"></GridColumn>
                                                <GridColumn Field=@nameof(VM_Inv_Pre_Sales_Techical_Offer_Details.HardCopyCode) AllowEditing="false" HeaderText="@languageContainer.Keys["TechnicalOffer_Code"]" TextAlign="TextAlign.Center"></GridColumn>
                                                <GridColumn Field=@nameof(VM_Inv_Pre_Sales_Techical_Offer_Details.The_Group) AllowEditing="false" HeaderText="@languageContainer.Keys["The_Group"]" TextAlign="TextAlign.Center"></GridColumn>
                                                <GridColumn Field=@nameof(VM_Inv_Pre_Sales_Techical_Offer_Details.Item) HeaderText="@languageContainer.Keys["Item"]" TextAlign="TextAlign.Center"></GridColumn>
                                                <GridColumn Field=@nameof(VM_Inv_Pre_Sales_Techical_Offer_Details.Code) AllowEditing="false" HeaderText="@languageContainer.Keys["Item_Code"]" TextAlign="TextAlign.Center"></GridColumn>
                                                @*<GridColumn Field=@nameof(VM_Inv_Pre_Sales_Techical_Offer_Details.Description) HeaderText="@languageContainer.Keys["Description"]" TextAlign="TextAlign.Center"></GridColumn>*@
                                                <GridColumn Field=@nameof(VM_Inv_Pre_Sales_Techical_Offer_Details.Current_Balance) AllowEditing="false" HeaderText="@languageContainer.Keys["Balance"]" TextAlign="TextAlign.Center"></GridColumn>
                                                <GridColumn Field=@nameof(VM_Inv_Pre_Sales_Techical_Offer_Details.Default_Price) AllowEditing="false" HeaderText="@languageContainer.Keys["Default_Price"]" TextAlign="TextAlign.Center"></GridColumn>
                                                <GridColumn Field=@nameof(VM_Inv_Pre_Sales_Techical_Offer_Details.Last_Purchase_Price) AllowEditing="false" HeaderText="@languageContainer.Keys["Last_Purchase_Price"]" TextAlign="TextAlign.Center"></GridColumn>
                                                <GridColumn Field=@nameof(VM_Inv_Pre_Sales_Techical_Offer_Details.Average_Purchase_Price) AllowEditing="false" HeaderText="@languageContainer.Keys["Average_Purchase_Price"]" TextAlign="TextAlign.Center"></GridColumn>
                                                <GridColumn Field=@nameof(VM_Inv_Pre_Sales_Techical_Offer_Details.Count) HeaderText="@languageContainer.Keys["Quantity"]" TextAlign="TextAlign.Center"></GridColumn>
                                                <GridColumn Field=@nameof(VM_Inv_Pre_Sales_Techical_Offer_Details.Notes) HeaderText="@languageContainer.Keys["Notes"]" TextAlign="TextAlign.Center"></GridColumn>
                                            </GridColumns>
                                        </SfGrid>
                                    </div>
                                </div>
                            </div>
                            @*-----------------------------------------------------------------------------------------------------*@
                            @*========================================= / Content Page   ========================================================*@
                        </div>
                    </ContentTemplate>
                </TabItem>
                @*========================================= / Tab   ======================================================*@
                @*========================================= Tab     بيانات العرض المالي  =================================*@
                <TabItem>
                    <ChildContent>
                        <TabHeader Text="@languageContainer.Keys["FinancialOffer_Data"]"></TabHeader>
                    </ChildContent>
                    <ContentTemplate>
                        <div class="tab-content">
                            @*=========================================  Content Page   ========================================================*@
                            @*---------------------------------------------- العرض المالي    ----------------------------------- -----------------*@
                            <div class="col-lg-12 control-section">
                                <div class="content-wrapper">
                                    <div class="row" style="direction:@languageContainer.Keys["Text_Direction"]">
                                        <div class="col-lg-12 text-center font-weight-bold" style="border:gray 1px solid;background-color:#1b809e;margin-top:20px;font-size:x-large;border-radius:5px;color:white">@languageContainer.Keys["FinancialOffer_Data"]</div>

                                        @*هل العرض شامل الضمان؟*@
                                        <div class="col-lg-3 font-weight-bold form-group" style="text-align:@languageContainer.Keys["Style_Text_Align"]">
                                            <SfDropDownList ShowClearButton="true" @ref="cmbGarantee_Encluded"
                                                            DataSource="DataSource_YesOrNo" TValue="string" CssClass="pr-1 pl-1"
                                                            ValueChanged="Update_garantee_Cost"
                                                            TItem="YesOrNo_Class" Placeholder='@languageContainer.Keys["GranteeIncluded"]'
                                                            FloatLabelType="@FloatLabelType.Always">
                                                <DropDownListFieldSettings Text="YesOrNo" Value="YesOrNo"></DropDownListFieldSettings>
                                            </SfDropDownList>
                                        </div>
                                        @*تكلفة الضمان؟*@
                                        <div class="col-lg-3 font-weight-bold form-group" style="text-align:@languageContainer.Keys["Style_Text_Align"]">
                                            <SfNumericTextBox @ref="seGarantee_Cost" TValue="decimal"
                                                              Enabled="Garantee_Cost_enabled"
                                                              ValueChanged="Update_Extra_Costs"
                                                              Placeholder='@languageContainer.Keys["Garantee_Cost"]'
                                                              Min="0" Max="1000000" FloatLabelType="@FloatLabelType.Always"
                                                              CssClass='form-control'></SfNumericTextBox>
                                        </div>
                                        @*مدة الضمان؟*@
                                        <div class="col-lg-3 font-weight-bold form-group" style="text-align:@languageContainer.Keys["Style_Text_Align"]">
                                            <SfNumericTextBox @bind-Value="seGarantee_Month" TValue="int"
                                                              Enabled="Garantee_Month_enabled"
                                                              Placeholder='@languageContainer.Keys["Garantee_Month"]'
                                                              Min="0" Max="1000000" FloatLabelType="@FloatLabelType.Always"
                                                              CssClass='form-control'></SfNumericTextBox>
                                        </div>
                                        @*تكلفة الشحن*@
                                        <div class="col-lg-3 font-weight-bold form-group" style="text-align:@languageContainer.Keys["Style_Text_Align"]">
                                            <SfNumericTextBox @ref="seShipping_Chargest" TValue="decimal"
                                                              ValueChanged="Update_Extra_Costs"
                                                              Placeholder='@languageContainer.Keys["Shipping_Chargest"]' Min="0" Max="1000000" FloatLabelType="@FloatLabelType.Always" CssClass='form-control'></SfNumericTextBox>
                                        </div>
                                        @*هل العرض شامل زيارات؟*@
                                        <div class="col-lg-3 font-weight-bold form-group" style="text-align:@languageContainer.Keys["Style_Text_Align"]">
                                            <SfDropDownList ShowClearButton="true" @ref="cmbMaintanance_Visit_Included"
                                                            DataSource="DataSource_YesOrNo" TValue="string" CssClass="pr-1 pl-1"
                                                            ValueChanged="Update_Visits_Cost"
                                                            TItem="YesOrNo_Class"
                                                            Placeholder='@languageContainer.Keys["Maintanance_Visit_Includedncluded"]'
                                                            FloatLabelType="@FloatLabelType.Always">
                                                <DropDownListFieldSettings Text="YesOrNo" Value="YesOrNo"></DropDownListFieldSettings>
                                            </SfDropDownList>
                                        </div>
                                        @*تكلفة الزيارات؟*@
                                        <div class="col-lg-3 font-weight-bold form-group" style="text-align:@languageContainer.Keys["Style_Text_Align"]">
                                            <SfNumericTextBox @ref="seMaintanance_Visit_Cost"
                                                              Enabled="seMaintanance_Visit_Cost_enabled" TValue="decimal"
                                                              Placeholder='@languageContainer.Keys["Maintanance_Visit_Included_Cost"]'
                                                              ValueChanged="Update_Extra_Costs"
                                                              Min="0" Max="1000000" FloatLabelType="@FloatLabelType.Always"
                                                              CssClass='form-control'></SfNumericTextBox>
                                        </div>
                                        @*عدد الزيارات؟*@
                                        <div class="col-lg-3 font-weight-bold form-group" style="text-align:@languageContainer.Keys["Style_Text_Align"]">
                                            <SfNumericTextBox @bind-Value="seMaintanance_Visit_Month" TValue="int"
                                                              Enabled="Maintanance_Visit_Month_enabled"
                                                              Placeholder='@languageContainer.Keys["Maintanance_Visit_Included_Month"]'
                                                              Min="0" Max="1000000" FloatLabelType="@FloatLabelType.Always"
                                                              CssClass='form-control'></SfNumericTextBox>
                                        </div>

                                        @*تكلفة المشال*@
                                        <div class="col-lg-3 font-weight-bold form-group" style="text-align:@languageContainer.Keys["Style_Text_Align"]">
                                            <SfNumericTextBox @ref="seLefting_Charges" TValue="decimal"
                                                              ValueChanged="Update_Extra_Costs"
                                                              Placeholder='@languageContainer.Keys["Lefting_Charges"]'
                                                              Min="0" Max="1000000" FloatLabelType="@FloatLabelType.Always" CssClass='form-control'></SfNumericTextBox>
                                        </div>
                                        @*تكلفة الإنتقالات*@
                                        <div class="col-lg-3 font-weight-bold form-group" style="text-align:@languageContainer.Keys["Style_Text_Align"]">
                                            <SfNumericTextBox @ref="seTransportation_Charges" TValue="decimal"
                                                              ValueChanged="Update_Extra_Costs"
                                                              Placeholder='@languageContainer.Keys["Transportation_Charges"]'
                                                              Min="0" Max="1000000" FloatLabelType="@FloatLabelType.Always" CssClass='form-control'></SfNumericTextBox>
                                        </div>
                                        @*تكلفة التجهيزات*@
                                        <div class="col-lg-3 font-weight-bold form-group" style="text-align:@languageContainer.Keys["Style_Text_Align"]">
                                            <SfNumericTextBox @ref="sePreparation_Charges" TValue="decimal"
                                                              ValueChanged="Update_Extra_Costs"
                                                              Placeholder='@languageContainer.Keys["Preparation_Charges"]'
                                                              Min="0" Max="1000000" FloatLabelType="@FloatLabelType.Always" CssClass='form-control'></SfNumericTextBox>
                                        </div>
                                        @*تكلفة مقاول الباطن*@
                                        <div class="col-lg-3 font-weight-bold form-group" style="text-align:@languageContainer.Keys["Style_Text_Align"]">
                                            <SfNumericTextBox @ref="seSubcontractor_Cost" TValue="decimal"
                                                              ValueChanged="Update_Extra_Costs"
                                                              Placeholder='@languageContainer.Keys["Subcontractor_Cost"]'
                                                              Min="0" Max="1000000" FloatLabelType="@FloatLabelType.Always" CssClass='form-control'></SfNumericTextBox>
                                        </div>
                                        @*بيان مقاول الباطن*@
                                        <div class="col-lg-3 font-weight-bold form-group" style="text-align:@languageContainer.Keys["Style_Text_Align"]">
                                            <SfTextBox @bind-Value="txtSubcontractor_Statment"
                                                       Placeholder='@languageContainer.Keys["Subcontractor_Statment"]'
                                                       FloatLabelType="@FloatLabelType.Always" CssClass='form-control'></SfTextBox>
                                        </div>
                                        @*تكالف أخرى*@
                                        <div class="col-lg-3 font-weight-bold form-group" style="text-align:@languageContainer.Keys["Style_Text_Align"]">
                                            <SfNumericTextBox @ref="seOtherCharges_Cost" TValue="decimal"
                                                              ValueChanged="Update_Extra_Costs"
                                                              Placeholder='@languageContainer.Keys["OtherCharges_Cost"]' Min="0" Max="1000000" FloatLabelType="@FloatLabelType.Always" CssClass='form-control'></SfNumericTextBox>
                                        </div>
                                        @*بيان تكالف أخرى*@
                                        <div class="col-lg-3 font-weight-bold form-group" style="text-align:@languageContainer.Keys["Style_Text_Align"]">
                                            <SfTextBox @bind-Value="txtOtherCharges_Statment"
                                                       Placeholder='@languageContainer.Keys["OtherCharges_Statment"]'
                                                       FloatLabelType="@FloatLabelType.Always" CssClass='form-control'></SfTextBox>
                                        </div>
                                        @*مبلغ الربح*@
                                        <div class="col-lg-3 font-weight-bold form-group" style="text-align:@languageContainer.Keys["Style_Text_Align"]">
                                            <SfNumericTextBox @ref="seProfit_Value" TValue="decimal"
                                                              ValueChanged="Update_Profits"
                                                              Placeholder='@languageContainer.Keys["Profit"]'
                                                              Min="0" Max="10000000" FloatLabelType="@FloatLabelType.Always" CssClass='form-control'></SfNumericTextBox>
                                        </div>
                                        @* ملاحظات *@
                                        <div class="col-lg-3 font-weight-bold form-group" style="text-align:@languageContainer.Keys["Style_Text_Align"]">
                                            <SfTextBox @bind-Value="txtNotes" Placeholder='@languageContainer.Keys["Notes"]' FloatLabelType="@FloatLabelType.Always" CssClass='form-control'></SfTextBox>
                                        </div>
                                        @* هل العرض شامل الضريبة؟ *@
                                        <div class="col-lg-3 font-weight-bold form-group" style="text-align:@languageContainer.Keys["Style_Text_Align"]">
                                            <SfDropDownList ShowClearButton="true" @ref="cmbVat_Includedncluded"
                                                            DataSource="DataSource_YesOrNo" TValue="string" CssClass="pr-1 pl-1"
                                                            ValueChanged="Update_Vat"
                                                            TItem="YesOrNo_Class"
                                                            Placeholder='@languageContainer.Keys["Vat_Includedncluded"]'
                                                            FloatLabelType="@FloatLabelType.Always">
                                                <DropDownListFieldSettings Text="YesOrNo" Value="YesOrNo"></DropDownListFieldSettings>
                                            </SfDropDownList>
                                        </div>
                                        @*---------------------------------------------------------------------------------------------------------------------------*@
                                    </div>
                                </div>
                            </div>
                            @*-----------------------------------------------------------------------------------------------------*@
                            @*========================================= / Content Page   ========================================================*@
                        </div>
                    </ContentTemplate>
                </TabItem>
                @*========================================= / Tab   ======================================================*@
                @*========================================= Tab  دفعات واقساط ========================================================*@
                <TabItem>
                    <ChildContent>
                        <TabHeader Text="@languageContainer.Keys["PaymentsAndInstallments"]"></TabHeader>
                    </ChildContent>
                    <ContentTemplate>
                        <div class="tab-content">
                            @*=========================================  Content Page   ========================================================*@
                            @*---------------------------------------------- العرض المالي    ----------------------------------- -----------------*@
                            <div class="col-lg-12 control-section">
                                <div class="content-wrapper">
                                    <div class="row">
                                        @*-------------------------------------------------- شبكة الدُفعات والاقساط --------------------------------- -----------------*@
                                        <div class="col-lg-12 control-section">
                                            <div class="content-wrapper">
                                                <div class="row">
                                                    <div class="col-lg-12 text-center font-weight-bold" style="border:#808080 1px solid;background-color:#1b809e;margin-top:20px;font-size:x-large;border-radius:5px;color:white">@languageContainer.Keys["PaymentsAndInstallments"]</div>
                                                    <SfGrid @ref="grdPayments" EnableRtl="true" DataSource="DataSource_grdPayments"
                                                            AllowResizing="true" AllowSelection="true" Width="100%"
                                                            AllowPaging="true"
                                                            Toolbar="@(new string[] {"Search" ,"Add","Edit","Delete"})">
                                                        <GridEvents OnActionBegin="ActionBegin_Payments"
                                                                    TValue="VM_Inv_Pre_Sales_Financial_Offer_Payments"></GridEvents>
                                                        <GridEditSettings ShowDeleteConfirmDialog="true"
                                                                          ShowConfirmDialog="true"
                                                                          AllowAdding="true"
                                                                          AllowDeleting="true"
                                                                          AllowEditing="true"
                                                                          Mode="@Syncfusion.Blazor.Grids.EditMode.Dialog"></GridEditSettings>
                                                        <GridColumns>
                                                            <GridColumn Field=@nameof(VM_Inv_Pre_Sales_Financial_Offer_Payments.ID) Visible="false" IsPrimaryKey="true" IsIdentity="true" HeaderText="@languageContainer.Keys["Item"]" TextAlign="TextAlign.Center"></GridColumn>
                                                            <GridColumn Field=@nameof(VM_Inv_Pre_Sales_Financial_Offer_Payments.Financial_Offer_HardCopyCode) Visible="false" AllowEditing="false" HeaderText="@languageContainer.Keys["FinancialOffer_Code"]" TextAlign="TextAlign.Center"></GridColumn>
                                                            <GridColumn Field=@nameof(VM_Inv_Pre_Sales_Financial_Offer_Payments.Customer) Visible="false" AllowEditing="false" HeaderText="@languageContainer.Keys["Customer_Name"]" TextAlign="TextAlign.Center"></GridColumn>
                                                            <GridColumn Field=@nameof(VM_Inv_Pre_Sales_Financial_Offer_Payments.Required) Visible="false" AllowEditing="false" HeaderText="@languageContainer.Keys["Required"]" TextAlign="TextAlign.Center"></GridColumn>
                                                            <GridColumn Field=@nameof(VM_Inv_Pre_Sales_Financial_Offer_Payments.Value) ValidationRules="@(new { number = true })" HeaderText="@languageContainer.Keys["Value"]" TextAlign="TextAlign.Center"></GridColumn>
                                                            <GridColumn Field=@nameof(VM_Inv_Pre_Sales_Financial_Offer_Payments.Statment) HeaderText="@languageContainer.Keys["Statement"]" TextAlign="TextAlign.Center"></GridColumn>
                                                            <GridColumn Field=@nameof(VM_Inv_Pre_Sales_Financial_Offer_Payments.Done_Date) Visible="false" EditType="EditType.DatePickerEdit" Format="d/M/yyyy" Type="ColumnType.Date" HeaderText="@languageContainer.Keys["DoneDate"]" TextAlign="TextAlign.Center"></GridColumn>
                                                            <GridColumn Field=@nameof(VM_Inv_Pre_Sales_Financial_Offer_Payments.Required_Date) EditType="EditType.DatePickerEdit" Format="d/M/yyyy" Type="ColumnType.Date" HeaderText="@languageContainer.Keys["RequireDate"]" TextAlign="TextAlign.Center"></GridColumn>
                                                            <GridColumn Field=@nameof(VM_Inv_Pre_Sales_Financial_Offer_Payments.Notes) Visible="false" HeaderText="@languageContainer.Keys["Notes"]" TextAlign="TextAlign.Center"></GridColumn>
                                                        </GridColumns>
                                                    </SfGrid>
                                                </div>
                                            </div>
                                        </div>
                                        @*-----------------------------------------------------------------------------------------------------*@
                                    </div>
                                </div>
                            </div>
                            @*-----------------------------------------------------------------------------------------------------*@
                            @*========================================= / Content Page   ========================================================*@
                        </div>
                    </ContentTemplate>
                </TabItem>
                @*========================================= / Tab   ======================================================*@
                @*========================================= Tab الحقوق القانونية ========================================================*@
                <TabItem>
                    <ChildContent>
                        <TabHeader Text="@languageContainer.Keys["LegalTerms"]"></TabHeader>
                    </ChildContent>
                    <ContentTemplate>
                        <div class="tab-content">

                            @*=========================================  Content Page   ========================================================*@

                            @*---------------------------------------------- الحقوق القانونية   ----------------------------------- -----------------*@

                            <div class="col-lg-12 control-section">
                                <div class="content-wrapper">
                                    <div class="row">

                                        @*--------------------------------------------------جميع الحقوق القانونية  --------------------------------- -----------------*@

                                        <div class="col-lg-12 control-section">
                                            <div class="content-wrapper">
                                                <div class="row">
                                                    <div class="col-lg-12 text-center font-weight-bold" style="border:#808080 1px solid;background-color:#1b809e;margin-top:20px;font-size:x-large;border-radius:5px;color:white">@languageContainer.Keys["AllLegalTerms_Corporation"]</div>
                                                    <SfGrid @ref="grdLegalTerms" EnableRtl="true" DataSource="DataSource_LegalTerms" AllowResizing="true" AllowSelection="true" Width="100%" AllowPaging="true" Toolbar="@(new string[] { "Search" , "Add" , "Delete" , "Edit" })">
                                                        <GridEvents RowSelected="RowSelect_LegalTerms" OnActionBegin="ActionBegin_LegalTerms" TValue="VM_Legal_Terms"></GridEvents>
                                                        <GridEditSettings AllowAdding="true" AllowEditOnDblClick="true" ShowDeleteConfirmDialog="true" ShowConfirmDialog="true" AllowEditing="true" AllowDeleting="true" Mode="@Syncfusion.Blazor.Grids.EditMode.Dialog"></GridEditSettings>
                                                        <GridColumns>
                                                            <GridColumn Field=@nameof(VM_Legal_Terms.ID) Visible="true" IsPrimaryKey="true" IsIdentity="true" DefaultValue="1" HeaderText="@languageContainer.Keys["ID"]" TextAlign="TextAlign.Center" Width="60px"></GridColumn>
                                                            <GridColumn Field=@nameof(VM_Legal_Terms.Statement) HeaderText="@languageContainer.Keys["Statement"]" TextAlign="TextAlign.Right" Width="700px"></GridColumn>
                                                            <GridColumn Field=@nameof(VM_Legal_Terms.CreatedBy) AllowEditing="false" HeaderText="@languageContainer.Keys["Issuance_By"]" TextAlign="TextAlign.Center"></GridColumn>
                                                            <GridColumn Field=@nameof(VM_Legal_Terms.Notes) EditType="EditType.DefaultEdit" HeaderText="@languageContainer.Keys["Notes"]" TextAlign="TextAlign.Center"></GridColumn>
                                                        </GridColumns>
                                                    </SfGrid>
                                                </div>
                                            </div>
                                        </div>
                                        @*-----------------------------------------------------------------------------------------------------*@
                                        <div class="col-lg-12 control-section form-group m-3">
                                            <div class="row">
                                                <div class="col-lg-2"></div>
                                                <div class="col-lg-3 font-weight-bold form-group" style="margin-top:auto">
                                                    <SfButton @onclick="btnAddItem_LegalTerms" type="button" CssClass="e-btn e-normal e-info form-control font-weight-bold">@languageContainer.Keys["Add"]</SfButton>
                                                </div>
                                                <div class="col-lg-2"></div>

                                                <div class="col-lg-3 font-weight-bold form-group" style="margin-top:auto">
                                                    <SfButton @ref="ref_btnAddAllItem_LegalTerms" @onclick="btnAddAllItem_LegalTerms" type="button" CssClass="e-btn e-normal e-info form-control font-weight-bold">@languageContainer.Keys["AddAll"]</SfButton>
                                                </div>
                                                <div class="col-lg-2"></div>
                                            </div>
                                        </div>
                                        @*--------------------------------------------------------    الحقوق القانونية بالعقد---------------------------------*@
                                        <div class="col-lg-12 control-section">
                                            <div class="content-wrapper">
                                                <div class="row">
                                                    <div class="col-lg-12 text-center font-weight-bold" style="border:#808080 1px solid;background-color:#1b809e;margin-top:20px;font-size:x-large;border-radius:5px;color:white">@languageContainer.Keys["LegalTerms_Contracting"]</div>
                                                    <SfGrid @ref="grdLegalTerms_Items" EnableRtl="true" DataSource="DataSource_LegalTerms_Items" AllowResizing="true" AllowSelection="true" Width="100%" AllowPaging="true" Toolbar="@(new string[] { "Search" , "Delete"})">
                                                        <GridEditSettings AllowAdding="true" ShowDeleteConfirmDialog="true" ShowConfirmDialog="true" AllowDeleting="true" Mode="@Syncfusion.Blazor.Grids.EditMode.Dialog"></GridEditSettings>
                                                        <GridColumns>
                                                            <GridColumn Field=@nameof(vM_Legal_Terms.ID) Visible="false" IsPrimaryKey="true" IsIdentity="true" DefaultValue="1" HeaderText="@languageContainer.Keys["ID"]" TextAlign="TextAlign.Center" Width="60px"></GridColumn>
                                                            <GridColumn Field=@nameof(vM_Legal_Terms.Statement) HeaderText="@languageContainer.Keys["Statement"]" TextAlign="TextAlign.Right"></GridColumn>
                                                        </GridColumns>
                                                    </SfGrid>
                                                </div>
                                            </div>
                                        </div>
                                        @*-----------------------------------------------------------------------------------------------------*@

                                    </div>
                                </div>
                            </div>

                            @*-----------------------------------------------------------------------------------------------------*@
                            @*========================================= / Content Page   ========================================================*@


                        </div>
                    </ContentTemplate>
                </TabItem>
                @*========================================= / Tab   ======================================================*@

            </TabItems>
        </SfTab>
        @*========================================= All Tabs   ========================================================*@
    </div>
</div>
@*-------------------- / End Container Page ---------------------------*@
@*========================================= Toast Custom   Code ============================================================*@
<SfToast ID="Failed_Id_Custom" @ref="Toast_Custom_Failed"
         TimeOut="5000" Icon="e-error toast-icons" CssClass="e-toast-danger"
         Title="@languageContainer.Keys["Toast_Title_Failed"]"
         Content="@ToastContent">
    <ToastPosition X="Right" Y="Bottom"></ToastPosition>
</SfToast>
@*========================================= / Toast Custom   Code =============================================================*@
@*========================================= / Toast  Success =================================================================*@
<SfToast ID="Success_Id" @ref="Toast_Success" TimeOut="4000" CssClass="e-toast-success" Icon="e-success toast-icons" Title="@languageContainer.Keys["Toast_Title_Success"]" Content="@languageContainer.Keys["Toast_Content_Success"]">
    <ToastPosition X="Right" Y="Bottom"></ToastPosition>
</SfToast>
@*========================================= / Toast  Success ==================================================================*@
@*-----------------------------------------------------------------------------------------------------*@
@*--------------------------------------------  Code --------------------------------------------------*@
@*-----------------------------------------------------------------------------------------------------*@

@code {

    //المتغيرات
    #region Global Variables
    int PaymentsCount = 0;
    double tmpDouble;
    bool seMaintanance_Visit_Cost_enabled=false,Maintanance_Visit_Month_enabled=false,Garantee_Cost_enabled=false,Garantee_Month_enabled =  false ;
    string QuerySting;
    bool Still_Loading = true;
    bool chkPayments_Requie;
    string QueryString , StateMent , User_Name , FullName, txtHardCopyCode_TechnicalOffer_Value;
    long? RowId_TechnicalOffer ;
    string Url_Parm_Offer;
    string ToastContent;
    string txt_HardCopyCode, txtSubcontractor_Statment, txtOtherCharges_Statment, txtNotes, txtPayments_Statments;
    string[] LightGreen = { "color: #0b7924f0;font-weight:Bold" };
    string[] Pink = { "color: #dc3545ee;font-weight:Bold" };
    string cmbGranteeIncluded, cmbPayments_Requie;
    string txtHardCopyCode_FinancialOffer_Value, txtPayments_Notes, cmbCustomer_Value;
    string txtTechnical_Offer_Cost_Value;
    string txtFiniancial_Offer_Profit, txtVat;
    string txtFiniancial_Offer_Customer_Cost;
    decimal seTechnicalOffer_Total, sePayments_Value;
    double AllCosts_WithVat;
    string AllCosts_NoVat;
    int seGarantee_Month, seMaintanance_Visit_Month, RowId_LegalTerms;
    List<string>DataSource_AvailablerSupplier = new List<string>();
    DateTime deValidTo = DateTime.Now, dePayments_RequiredDate = DateTime.Now, dePayments_DoneDate = DateTime.Now;
    SfDropDownList<string,YesOrNo_Class>cmbGarantee_Encluded, cmbMaintanance_Visit_Included, cmbVat_Includedncluded;
    SfGrid<VM_Inv_Pre_Sales_Techical_Offer>
        grdTechnicalOffers;
    SfGrid<VM_Inv_Pre_Sales_Techical_Offer_Details>
        grdTechnicalOffer_Details;
    SfGrid<VM_Inv_Pre_Sales_Financial_Offer_Payments>
        grdPayments;
    SfGrid<VM_Legal_Terms> grdLegalTerms, grdLegalTerms_Items;
    SfButton ref_btnSave_FiancialOffer , ref_btnAddAllItem_LegalTerms;

    SfTextBox txtFiniancial_Offer_Total_Extra_Costs = new SfTextBox();
    SfNumericTextBox<Decimal>
    seGarantee_Cost;
    SfNumericTextBox<Decimal>
        seMaintanance_Visit_Cost;
    SfNumericTextBox<Decimal>
        seShipping_Chargest;
    SfNumericTextBox<Decimal>
        seLefting_Charges;
    SfNumericTextBox<Decimal>
        seTransportation_Charges;
    SfNumericTextBox<Decimal>
        sePreparation_Charges;
    SfNumericTextBox<Decimal>
        seSubcontractor_Cost;
    SfNumericTextBox<Decimal>
        seOtherCharges_Cost;
    SfNumericTextBox<Decimal>
        seProfit_Value;
    SfButton ref_btn_HardCopyCode;
    SfToast Toast_Success, Toast_Custom_Failed;
    VM_Inv_Pre_Sales_Techical_Offer_Details vM_Inv_Pre_Sales_Techical_Offer_Details = new VM_Inv_Pre_Sales_Techical_Offer_Details();
    List<VM_Inv_Pre_Sales_Techical_Offer>
        DataSource_TechnicalOffers = new List<VM_Inv_Pre_Sales_Techical_Offer>
            ();
    List<VM_Inv_Pre_Sales_Techical_Offer_Details>
        DataSource_TechnicalOffer_Details = new List<VM_Inv_Pre_Sales_Techical_Offer_Details>
            ();
    VM_Inv_Pre_Sales_Financial_Offer_Payments vM_Inv_Pre_Sales_Financial_Offer_Payments = new VM_Inv_Pre_Sales_Financial_Offer_Payments();
    List<VM_Inv_Pre_Sales_Financial_Offer_Payments>
        DataSource_grdPayments = new List<VM_Inv_Pre_Sales_Financial_Offer_Payments>
            ();
    VM_Inv_Pre_Sales_Financial_Offer vM_Inv_Pre_Sales_Financial_Offer = new VM_Inv_Pre_Sales_Financial_Offer();

    List<VM_Legal_Terms> DataSource_LegalTerms = new List<VM_Legal_Terms>();
    List<VM_Legal_Terms> DataSource_LegalTerms_Items = new List<VM_Legal_Terms>();
    List<string> LegalItems_Terms_List = new List<string>();

    //Permissions Permissions_Obj = new Permissions();
    [CascadingParameter] protected Task<AuthenticationState> AuthStat { get; set; }

    VM_Legal_Terms vM_Legal_Terms = new VM_Legal_Terms();
    VM_Legal_Terms vM_Legal_Terms2 = new VM_Legal_Terms();
    VM_Legal_Terms vM_Legal_Terms3 = new VM_Legal_Terms();

    List<YesOrNo_Class>
DataSource_YesOrNo = new List<YesOrNo_Class>
    ();
    public class YesOrNo_Class
    {
        public string YesOrNo { get; set; }
    }
    #endregion

    //كود التهئة و بداية التحميل
    protected override async Task OnInitializedAsync()
    {
        txtFiniancial_Offer_Profit = "0.00";
        txtFiniancial_Offer_Total_Extra_Costs.Value = "0.00";
        txtTechnical_Offer_Cost_Value = "0.00";
        txtFiniancial_Offer_Profit = "0.00";

        txtHardCopyCode_FinancialOffer_Value = await httpClient.GetStringAsync(Configuration.GetValue<string>("Api") + "/api/Services/GetNextHardCopyCode?tbl=Inv_Pre_Sales_Financial_Offer&Form=Financial_Offers");
        DataSource_AvailablerSupplier = await httpClient.GetJsonAsync<List<string>>(Configuration.GetValue<string>("Api") + "/api/Services/ReadColumn?QueryString=" + "select Title From Def_Accounts_api where Type='عميل'&Required_Field=Title");
        deValidTo = DateTime.Now.AddDays(14);
        DataSource_TechnicalOffers = await httpClient.GetJsonAsync<List<VM_Inv_Pre_Sales_Techical_Offer>>(Configuration.GetValue<string>("Api") + "/api/Services/ReadTable?QueryString=select * From Inv_Pre_Sales_Techical_Offer Where Approved_By !=''");

        DataSource_YesOrNo = new List<YesOrNo_Class> { new YesOrNo_Class { YesOrNo = "نعم" }, new YesOrNo_Class { YesOrNo = "لا" } };
        DataSource_LegalTerms = await httpClient.GetJsonAsync<List<VM_Legal_Terms>>(Configuration.GetValue<string>("Api") + "/api/Legal_Terms");

    }
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        //Permissions_Obj = await sessionStorage.GetItemAsync<Permissions>("Permissions");
        //User_Name = Permissions_Obj.UserName;
        //FullName = Permissions_Obj.Full_Name;
        /////////////////////////////////////////
        var user = (await AuthStat).User;
        User_Name = user.Identity.Name;
        FullName = user.Identity.Name;
        /////////////////////////////////////////
    }

    // تحديد صف العرض الفني و بالتالي إختيار الكود الخاص به cmbVat_Includedncluded
    public async void RowSelect_TechnicalOffers(RowSelectEventArgs<VM_Inv_Pre_Sales_Techical_Offer> Args)
    {
        RowId_TechnicalOffer = Args.Data.HardCopyCode;
        this.DataSource_TechnicalOffer_Details = await httpClient.GetJsonAsync<List<VM_Inv_Pre_Sales_Techical_Offer_Details>>(Configuration.GetValue<string>("Api") + "/api/Services/ReadTable?QueryString=select * From Inv_Pre_Sales_Techical_Offer_Details Where HardCopyCode = '" + RowId_TechnicalOffer + "'");
        txtHardCopyCode_TechnicalOffer_Value = Args.Data.HardCopyCode.ToString();

        //QuerySting = "select sum( [Count]*[Default_Price]) as TechnicalOffer_Value From [Inv_Pre_Sales_Techical_Offer_Details] where hardCopyCode='" + Args.Data.HardCopyCode + "' group by HardCopyCode" + "&Required_Field=TechnicalOffer_Value";
        //txtTechnical_Offer_Cost_Value = await httpClient.GetStringAsync(Configuration.GetValue<string>("Api") + "/api/Services/ReadField?QueryString=" + QuerySting);
        QuerySting = "select Total_Items_Cost From [Inv_Pre_Sales_Techical_Offer] where hardCopyCode='" + Args.Data.HardCopyCode + "' &Required_Field=Total_Items_Cost";
        txtTechnical_Offer_Cost_Value = await httpClient.GetStringAsync(Configuration.GetValue<string>("Api") + "/api/Services/ReadField?QueryString=" + QuerySting);

        txtTechnical_Offer_Cost_Value = txtTechnical_Offer_Cost_Value.Replace("\"", "");
        Still_Loading = false;
        StateHasChanged();
    }

    //تحديث السعر النهائي
    public void Update_Prices()
    {
        if (Still_Loading == false &&
            double.TryParse(txtTechnical_Offer_Cost_Value, out tmpDouble) == true &&
            double.TryParse(txtFiniancial_Offer_Total_Extra_Costs.Value, out tmpDouble) == true &&
            double.TryParse(txtFiniancial_Offer_Profit, out tmpDouble) == true)
        {
            txtFiniancial_Offer_Customer_Cost = (Convert.ToDouble(txtTechnical_Offer_Cost_Value) +
  Convert.ToDouble(txtFiniancial_Offer_Total_Extra_Costs.Value) + AllCosts_WithVat +
  Convert.ToDouble(txtFiniancial_Offer_Profit)).ToString("#.##");

            AllCosts_NoVat = (Convert.ToDouble(txtTechnical_Offer_Cost_Value) +
Convert.ToDouble(txtFiniancial_Offer_Total_Extra_Costs.Value)  +
Convert.ToDouble(txtFiniancial_Offer_Profit)).ToString("#.##");

        }
    }

    //خانة تكلفة الضمان
    public void Update_garantee_Cost()
    {
        seGarantee_Cost.Value = 0;
        if (cmbGarantee_Encluded.Text == "نعم")
        {
            Garantee_Cost_enabled = true;
            Garantee_Month_enabled = true;
        }
        else
        {
            Garantee_Cost_enabled = false;
            Garantee_Month_enabled = false;
        }
    }

    //خانة تكلفة الزيارات
    public void Update_Visits_Cost()
    {
        seMaintanance_Visit_Cost.Value = 0;
        if (cmbMaintanance_Visit_Included.Text == "نعم")
        {
            seMaintanance_Visit_Cost_enabled = true;
            Maintanance_Visit_Month_enabled = true;
        }
        else
        {
            seMaintanance_Visit_Cost_enabled = false;
            Maintanance_Visit_Month_enabled = false;
        }
    }

    //خانة تكلفة الضريبة
    public void Update_Vat()
    {
        if (cmbVat_Includedncluded.Text == "نعم")
        {
            AllCosts_WithVat = ((Convert.ToDouble(txtTechnical_Offer_Cost_Value) +
Convert.ToDouble(txtFiniancial_Offer_Total_Extra_Costs.Value) +
Convert.ToDouble(txtFiniancial_Offer_Profit)))* 0.15 ;
            txtVat = AllCosts_WithVat.ToString("#.##");
        }
        else
        {
            AllCosts_WithVat = 0;
            txtVat ="0";
        }
    }

    //تحديث  خانة التكلفة الإضافية
    public void Update_Extra_Costs()
    {
        StateHasChanged();
        txtFiniancial_Offer_Total_Extra_Costs.Value = (Convert.ToDouble(seGarantee_Cost.Value) +
    Convert.ToDouble(seMaintanance_Visit_Cost.Value) +
    Convert.ToDouble(seShipping_Chargest.Value) +
    Convert.ToDouble(seLefting_Charges.Value) +
    Convert.ToDouble(seTransportation_Charges.Value) +
    Convert.ToDouble(sePreparation_Charges.Value) +
    Convert.ToDouble(seSubcontractor_Cost.Value) +
    Convert.ToDouble(seOtherCharges_Cost.Value)).ToString();
    }

    //تحديث  خانة الربح
    public void Update_Profits()
    {
        StateHasChanged();
        txtFiniancial_Offer_Profit = seProfit_Value.Value.ToString();
        Update_Extra_Costs();
    }

    // ألوان العرض
    public void CellColor_TechnicalOffers(QueryCellInfoEventArgs<VM_Inv_Pre_Sales_Techical_Offer>args)
    {
        if (!string.IsNullOrEmpty(args.Data.Approved_By))
        {
            args.Cell.AddStyle(LightGreen);
        }
    }

    // الأقساط
    public void ActionBegin_Payments(ActionEventArgs<VM_Inv_Pre_Sales_Financial_Offer_Payments> args)
    {
        try
        {
            if (args.RequestType.ToString() == "Delete")
            {
            }
            if (args.RequestType.ToString() == "Save")
            {
                if (args.Action == "add")
                {
                    args.Data.ID = PaymentsCount + 1;
                    PaymentsCount++;
                }
                else//editing
                {
                    // (Edit) Put Api
                }

            }
        }
        catch (Exception ex)
        {
            System.Diagnostics.Debug.WriteLine(ex.Message);
        }
    }

    // عمليات علي الحقوق القانونية
    public async void ActionBegin_LegalTerms(ActionEventArgs<VM_Legal_Terms> args)
    {
        try
        {
            if (args.RequestType.ToString() == "Delete")
            {
                await httpClient.DeleteAsync(Configuration.GetValue<string>("Api") + "/api/Legal_Terms/" + args.Data.ID);
                await this.Toast_Success.Show();
            }
            if (args.RequestType.ToString() == "Save")
            {
                if (args.Action == "add")
                {
                    // (Add) Post Api
                    vM_Legal_Terms2.Statement = args.Data.Statement;
                    vM_Legal_Terms2.CreatedBy = FullName;
                    vM_Legal_Terms2.Notes = args.Data.Notes;

                    await httpClient.PostJsonAsync(Configuration.GetValue<string>("Api") + "/api/Legal_Terms", vM_Legal_Terms2);
                    await this.Toast_Success.Show();

                }
                else//editing
                {
                    // (Edit) Put Api
                    vM_Legal_Terms3.ID = args.Data.ID;
                    vM_Legal_Terms3.Statement = args.Data.Statement;
                    vM_Legal_Terms3.CreatedBy = FullName;
                    vM_Legal_Terms3.Notes = args.Data.Notes;

                    await httpClient.PutJsonAsync(Configuration.GetValue<string>("Api") + "/api/Legal_Terms?id=" + args.Data.ID.ToString(), vM_Legal_Terms3);
                    await this.Toast_Success.Show();
                }

            }
        }
        catch (Exception ex)
        {
            System.Diagnostics.Debug.WriteLine(ex.Message);
        }
    }

    // تحديد صف الحقوق
    public  void RowSelect_LegalTerms(RowSelectEventArgs<VM_Legal_Terms> Args)
    {
        RowId_LegalTerms = Args.Data.ID;
        StateMent = Args.Data.Statement;
        vM_Legal_Terms.ID = RowId_LegalTerms;
        vM_Legal_Terms.Statement = StateMent;

        StateHasChanged();
    }

    // إضافة عنصر من الحقوق القانونية الي العقد
    protected async void btnAddItem_LegalTerms()
    {
        if (RowId_LegalTerms == 0)
        {
            this.Toast_Custom_Failed.Content = languageContainer.Keys["Toast_Failed_SelectRow"];
            this.Toast_Custom_Failed.Show();
            return;
        }
        foreach (var item in grdLegalTerms_Items.DataSource.ToList())
        {
            if (item.ID == RowId_LegalTerms)
            {
                this.Toast_Custom_Failed.Content = languageContainer.Keys["Toast_Content_Add_Failed"];
                this.Toast_Custom_Failed.Show();
                return;
            }
        }

        await grdLegalTerms_Items.AddRecord(vM_Legal_Terms);
        RowId_LegalTerms=0 ;
        StateHasChanged();

    }

    // إضافة كل العناصر من الحقوق القانونية الي العقد
    protected async void btnAddAllItem_LegalTerms()
    {
        DataSource_LegalTerms_Items.Clear();
        foreach (var item in grdLegalTerms.DataSource.ToList())
        {
            if (item.ID == RowId_LegalTerms)
            {
                this.Toast_Custom_Failed.Content = languageContainer.Keys["Toast_Content_Add_Failed"];
                this.Toast_Custom_Failed.Show();
                return;
            }
            await grdLegalTerms_Items.AddRecord(item);
        }

        ref_btnAddAllItem_LegalTerms.Disabled = true;

        StateHasChanged();

    }

    // كود حفظ العرض المالي 
    protected async void btnSave_FiancialOffer()
    {
        try
        {
            // مراجعة الحقول     

            if (string.IsNullOrEmpty(txtHardCopyCode_TechnicalOffer_Value))
            {
                this.Toast_Custom_Failed.Content = languageContainer.Keys["Missing"] + languageContainer.Keys["TechnicalOffer_Code"];
                this.Toast_Custom_Failed.Show();
                return;
            }

            if (string.IsNullOrEmpty(cmbCustomer_Value))
            {
                this.Toast_Custom_Failed.Content = languageContainer.Keys["Missing"] + languageContainer.Keys["Customer_Name"];
                this.Toast_Custom_Failed.Show();
                return;
            }

            if (deValidTo <= DateTime.Now)
            {
                this.Toast_Custom_Failed.Content = languageContainer.Keys["Date_NotValid"];
                this.Toast_Custom_Failed.Show();
                return;
            }

            if (decimal.Parse(txtFiniancial_Offer_Profit) <= 0)
            {
                this.Toast_Custom_Failed.Content = languageContainer.Keys["Missing"] + languageContainer.Keys["Profit"];
                this.Toast_Custom_Failed.Show();
                return;
            }
            if (string.IsNullOrEmpty(txtVat))
            {
                this.Toast_Custom_Failed.Content = languageContainer.Keys["Missing"] + languageContainer.Keys["Items_VAT"];
                this.Toast_Custom_Failed.Show();
                return;
            }

            if (string.IsNullOrEmpty(txtFiniancial_Offer_Customer_Cost))
            {
                this.Toast_Custom_Failed.Content = languageContainer.Keys["Missing"] + languageContainer.Keys["Total_Contracting"];
                this.Toast_Custom_Failed.Show();
                return;
            }

            if (Garantee_Month_enabled.Equals(true) & seGarantee_Month <= 0)
            {
                this.Toast_Custom_Failed.Content = languageContainer.Keys["Missing"] + languageContainer.Keys["Garantee_Month"];
                this.Toast_Custom_Failed.Show();
                return;
            }

            if (Maintanance_Visit_Month_enabled.Equals(true) & seMaintanance_Visit_Month <= 0)
            {
                this.Toast_Custom_Failed.Content = languageContainer.Keys["Missing"] + languageContainer.Keys["Maintanance_Visit_Included_Month"];
                this.Toast_Custom_Failed.Show();
                return;
            }


            ////    إضافة الحقوق القانونية

            if (grdLegalTerms_Items == null || grdLegalTerms_Items.TotalItemCount == 0)
            {
                this.Toast_Custom_Failed.Content = languageContainer.Keys["Missing"] + languageContainer.Keys["LegalTerms_Contracting"];
                this.Toast_Custom_Failed.Show();
                return;
            }
            if (grdLegalTerms_Items.TotalItemCount > 0)
            {

                foreach (var item in grdLegalTerms_Items.DataSource.ToList())
                {
                    LegalItems_Terms_List.Add((LegalItems_Terms_List.Count + 1) + " / " + item.Statement);
                }

            }
            ////    لم يتم زيارة تبويب الدفعات

            if (grdPayments == null)
            {
                this.Toast_Custom_Failed.Content = languageContainer.Keys["Visit"] +"  "+ languageContainer.Keys["PaymentsAndInstallments"];
                this.Toast_Custom_Failed.Show();
                return;
            }


            ref_btnSave_FiancialOffer.Disabled = true;

            ////    إضافة عرض مالي
            vM_Inv_Pre_Sales_Financial_Offer.HardCopyCode = Convert.ToInt64( txtHardCopyCode_FinancialOffer_Value);
            vM_Inv_Pre_Sales_Financial_Offer.Issuied_By = User_Name;
            vM_Inv_Pre_Sales_Financial_Offer.Issuied_At = DateTime.Now.ToString("dd/MM/yyyy HH:mm");
            vM_Inv_Pre_Sales_Financial_Offer.Technical_Offer_HardCopyCode = txtHardCopyCode_TechnicalOffer_Value;
            vM_Inv_Pre_Sales_Financial_Offer.Customer = cmbCustomer_Value;
            vM_Inv_Pre_Sales_Financial_Offer.Valid_To = deValidTo.ToString("dd/MM/yyyy HH:mm");
            vM_Inv_Pre_Sales_Financial_Offer.Technical_Offer_Total = decimal.Parse(txtTechnical_Offer_Cost_Value);
            vM_Inv_Pre_Sales_Financial_Offer.Profit_Value = decimal.Parse(txtFiniancial_Offer_Profit);
            vM_Inv_Pre_Sales_Financial_Offer.Contract_Total = decimal.Parse(txtFiniancial_Offer_Customer_Cost);
            vM_Inv_Pre_Sales_Financial_Offer.Garantee_Included = Garantee_Month_enabled;
            vM_Inv_Pre_Sales_Financial_Offer.Garantee_Cost = seGarantee_Cost.Value;
            vM_Inv_Pre_Sales_Financial_Offer.Garantee_Month = seGarantee_Month;
            vM_Inv_Pre_Sales_Financial_Offer.Maintenance_Visits_Included = Maintanance_Visit_Month_enabled;
            vM_Inv_Pre_Sales_Financial_Offer.Maintenance_Visits_Cost = seMaintanance_Visit_Cost.Value;
            vM_Inv_Pre_Sales_Financial_Offer.Maintenance_Visits_Month = seMaintanance_Visit_Month;
            vM_Inv_Pre_Sales_Financial_Offer.Shipping_Charges = seShipping_Chargest.Value;
            vM_Inv_Pre_Sales_Financial_Offer.Lefting_Charges = seLefting_Charges.Value;
            vM_Inv_Pre_Sales_Financial_Offer.Transportation_Charges = seTransportation_Charges.Value;
            vM_Inv_Pre_Sales_Financial_Offer.Preparation_Charges = sePreparation_Charges.Value;
            vM_Inv_Pre_Sales_Financial_Offer.Subcontractor_Cost = seSubcontractor_Cost.Value;
            vM_Inv_Pre_Sales_Financial_Offer.Subcontractor_Statement = txtSubcontractor_Statment;
            vM_Inv_Pre_Sales_Financial_Offer.Other_Charges = seOtherCharges_Cost.Value;
            vM_Inv_Pre_Sales_Financial_Offer.Other_Charges_Statement = txtOtherCharges_Statment;
            vM_Inv_Pre_Sales_Financial_Offer.Preparation_Charges = sePreparation_Charges.Value;
            vM_Inv_Pre_Sales_Financial_Offer.LegalTerms_Items = string.Join("^", LegalItems_Terms_List);
            vM_Inv_Pre_Sales_Financial_Offer.Notes = txtNotes;
            vM_Inv_Pre_Sales_Financial_Offer.Vat = decimal.Parse(txtVat);
            vM_Inv_Pre_Sales_Financial_Offer.Extra_Cost = decimal.Parse(txtFiniancial_Offer_Total_Extra_Costs.Value);
            vM_Inv_Pre_Sales_Financial_Offer.Total_Cost = decimal.Parse(AllCosts_NoVat);

            await httpClient.PostJsonAsync(Configuration.GetValue<string>("Api") + "/api/Pre_Sales_Financial_Offer", vM_Inv_Pre_Sales_Financial_Offer);

            ////    إضافة دفعات و أقساط

            if (grdPayments.TotalItemCount > 0)
            {
                foreach (var item in grdPayments.DataSource.ToList())
                {
                    vM_Inv_Pre_Sales_Financial_Offer_Payments.Value = item.Value;
                    vM_Inv_Pre_Sales_Financial_Offer_Payments.Statment = item.Statment;
                    vM_Inv_Pre_Sales_Financial_Offer_Payments.Required_Date = item.Required_Date;
                    vM_Inv_Pre_Sales_Financial_Offer_Payments.Financial_Offer_HardCopyCode = txtHardCopyCode_FinancialOffer_Value;
                    vM_Inv_Pre_Sales_Financial_Offer_Payments.Done_Date = DateTime.Now;
                    vM_Inv_Pre_Sales_Financial_Offer_Payments.Customer = cmbCustomer_Value;

                    await httpClient.PostJsonAsync(Configuration.GetValue<string>("Api") + "/api/Pre_Sales_Financial_Offer_Payments", vM_Inv_Pre_Sales_Financial_Offer_Payments);
                }
            }

            await this.Toast_Success.Show();
        }
        catch (Exception ex)
        {

            Debug.WriteLine("ex.Message >> " + ex.Message);
            //await jsRuntime.InvokeAsync<string>("console.log", "ex.Message >> " + ex.Message);

        }
    }

}

